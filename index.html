<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Schneider Electric Command Center</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{--b0:#08080d;--b1:#0e0e15;--b2:#161620;--b3:#1e1e2c;--bd:#2a2a3c;--bd2:#3a3a54;--t1:#ededf4;--t2:#9696ae;--t3:#5c5c72;--grn:#3ddc84;--blu:#4d9fff;--gld:#ffc857;--pur:#a855f7;--red:#ef4444;--cyn:#22d3ee;--se:#3dcc4a}
html,body{height:100%;overflow:hidden}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--b0);color:var(--t1);font-size:13px}
#app{display:flex;height:100vh}
#sb{width:220px;min-width:220px;background:var(--b1);border-right:1px solid var(--bd);display:flex;flex-direction:column;overflow-y:auto}
#mn{flex:1;overflow-y:auto;padding:24px}
.logo{padding:20px;border-bottom:1px solid var(--bd);display:flex;align-items:center;gap:10px}
.logo svg{width:32px;height:32px}
.logo span{font-weight:700;font-size:14px;color:var(--grn)}
.nav{padding:12px}
.nb{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:6px;color:var(--t2);font-size:12px;font-weight:500;cursor:pointer;transition:all .15s;background:none;width:100%;text-align:left;border:none}
.nb:hover{background:var(--b3);color:var(--t1)}
.nb.on{background:rgba(61,220,132,.08);color:var(--grn);border:1px solid rgba(61,220,132,.15)}
.nb svg{width:18px;height:18px;flex-shrink:0}
.sec{margin-bottom:32px}
.sec-t{font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--t3);margin-bottom:12px;font-weight:600}
.card{background:var(--b2);border:1px solid var(--bd);border-radius:12px;padding:20px;margin-bottom:16px}
.card-t{font-size:16px;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.card-t svg{color:var(--grn)}
.btn{background:var(--grn);color:var(--b0);border:none;padding:10px 20px;border-radius:6px;font-weight:600;cursor:pointer;font-size:13px;transition:all .15s}
.btn:hover{background:#2fc975;transform:translateY(-1px)}
.btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
.btn-s{background:var(--b3);color:var(--t1);border:1px solid var(--bd)}
.btn-s:hover{background:var(--bd);transform:translateY(-1px)}
.inp{background:var(--b3);border:1px solid var(--bd);color:var(--t1);padding:10px 14px;border-radius:6px;font-size:13px;width:100%}
.inp:focus{outline:none;border-color:var(--grn)}
select.inp{cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
.stat{text-align:center;padding:16px}
.stat-v{font-size:28px;font-weight:700;color:var(--grn)}
.stat-l{font-size:11px;color:var(--t3);text-transform:uppercase;margin-top:4px}
.tag{display:inline-block;padding:3px 8px;border-radius:4px;font-size:11px;font-weight:600}
.tag-g{background:rgba(61,220,132,.15);color:var(--grn)}
.tag-b{background:rgba(77,159,255,.15);color:var(--blu)}
.tag-r{background:rgba(239,68,68,.15);color:var(--red)}
.tag-y{background:rgba(255,200,87,.15);color:var(--gld)}
.ld{display:inline-block;width:20px;height:20px;border:2px solid var(--bd);border-top-color:var(--grn);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.brief-item{padding:16px;border-bottom:1px solid var(--bd)}
.brief-item:last-child{border-bottom:none}
.brief-cat{font-size:10px;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;font-weight:600}
.brief-title{font-weight:600;margin-bottom:6px;font-size:14px}
.brief-sum{color:var(--t2);font-size:13px;line-height:1.5}
.tbl{width:100%;border-collapse:collapse}
.tbl th,.tbl td{padding:12px;text-align:left;border-bottom:1px solid var(--bd)}
.tbl th{font-size:11px;text-transform:uppercase;color:var(--t3);font-weight:600}
.tbl tr:hover{background:var(--b3)}
.row{display:flex;gap:12px;margin-bottom:12px}
.row>*{flex:1}
.fm-g{margin-bottom:16px}
.fm-l{display:block;font-size:12px;color:var(--t2);margin-bottom:6px}
textarea.inp{min-height:80px;resize:vertical}
.hidden{display:none}
.price-up{color:var(--grn)}
.price-dn{color:var(--red)}
#brief-content{max-height:500px;overflow-y:auto}
.api-note{background:var(--b3);padding:12px;border-radius:6px;font-size:12px;color:var(--t2);margin-bottom:16px}
.result-box{background:var(--b1);border:1px solid var(--bd);border-radius:8px;padding:16px;margin-top:16px}
.outage-item{display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid var(--bd)}
.outage-item:last-child{border-bottom:none}
.outage-loc{font-weight:600}
.outage-det{font-size:12px;color:var(--t2)}
.chart-placeholder{height:200px;background:var(--b1);border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--t3);border:1px dashed var(--bd)}
</style>
</head>
<body>
<div id="app">
<div id="sb">
<div class="logo"><svg viewBox="0 0 32 32" fill="none"><circle cx="16" cy="16" r="14" stroke="#3ddc84" stroke-width="2"/><path d="M10 16h12M16 10v12" stroke="#3ddc84" stroke-width="2" stroke-linecap="round"/></svg><span>Schneider CC</span></div>
<div class="nav">
<button class="nb on" data-tool="brief"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>Daily Brief</button>
<button class="nb" data-tool="rates"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>Rate Calculator</button>
<button class="nb" data-tool="market"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>Market Monitor</button>
<button class="nb" data-tool="proposal"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>Proposal Builder</button>
<button class="nb" data-tool="regs"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"/></svg>Regulation Tracker</button>
<button class="nb" data-tool="load"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>Load Analyzer</button>
<button class="nb" data-tool="outage"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>Outage Map</button>
</div>
</div>
<div id="mn"></div>
  <script>
const mn=document.getElementById('mn');
const PERPLEXITY_API_KEY='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';

const tools={
brief:`<div class="sec"><div class="sec-t">Daily Brief</div>
<div class="card">
<div class="card-t"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>Energy Market Intelligence</div>
<div class="api-note">Powered by Perplexity AI - fetches real-time energy market news and analysis</div>
<div class="row">
<select class="inp" id="brief-topic">
<option value="energy market prices and trends today">Market Prices & Trends</option>
<option value="renewable energy news and developments">Renewable Energy News</option>
<option value="electricity grid reliability and demand">Grid Reliability & Demand</option>
<option value="energy policy and regulations news">Policy & Regulations</option>
<option value="Schneider Electric company news">Schneider Electric News</option>
</select>
<button class="btn" onclick="fetchBrief()">Generate Brief</button>
</div>
<div id="brief-content"><div style="color:var(--t3);padding:20px;text-align:center">Select a topic and click Generate Brief to get the latest intelligence</div></div>
</div></div>`,

rates:`<div class="sec"><div class="sec-t">Rate Calculator</div>
<div class="card">
<div class="card-t"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>Energy Cost Calculator</div>
<div class="row">
<div class="fm-g"><label class="fm-l">Utility Provider</label>
<select class="inp" id="calc-utility" onchange="updateRates()">
<option value="nvenergy">NV Energy (Nevada)</option>
<option value="pge">PG&E (California)</option>
<option value="sce">SCE (California)</option>
<option value="aps">APS (Arizona)</option>
<option value="custom">Custom Rates</option>
</select></div>
<div class="fm-g"><label class="fm-l">Rate Schedule</label>
<select class="inp" id="calc-schedule">
<option value="residential">Residential TOU</option>
<option value="commercial">Commercial TOU</option>
<option value="industrial">Industrial</option>
</select></div>
</div>
<div class="row">
<div class="fm-g"><label class="fm-l">Monthly Usage (kWh)</label><input type="number" class="inp" id="calc-kwh" value="1000"></div>
<div class="fm-g"><label class="fm-l">Peak Demand (kW)</label><input type="number" class="inp" id="calc-kw" value="5"></div>
</div>
<div class="row">
<div class="fm-g"><label class="fm-l">On-Peak %</label><input type="number" class="inp" id="calc-onpeak" value="40"></div>
<div class="fm-g"><label class="fm-l">Off-Peak %</label><input type="number" class="inp" id="calc-offpeak" value="60"></div>
</div>
<button class="btn" onclick="calculateRate()">Calculate Cost</button>
<div id="calc-result"></div>
</div></div>`,

market:`<div class="sec"><div class="sec-t">Market Monitor</div>
<div class="grid">
<div class="card"><div class="stat"><div class="stat-v" id="mkt-lmp">--</div><div class="stat-l">CAISO LMP ($/MWh)</div></div></div>
<div class="card"><div class="stat"><div class="stat-v" id="mkt-ng">--</div><div class="stat-l">Natural Gas ($/MMBtu)</div></div></div>
<div class="card"><div class="stat"><div class="stat-v" id="mkt-demand">--</div><div class="stat-l">Grid Demand (GW)</div></div></div>
<div class="card"><div class="stat"><div class="stat-v" id="mkt-renewable">--</div><div class="stat-l">Renewable %</div></div></div>
</div>
<div class="card">
<div class="card-t">Price Trends (Last 24h)</div>
<div class="chart-placeholder">Real-time chart would display here with actual API integration</div>
<div style="margin-top:16px"><button class="btn" onclick="refreshMarket()">Refresh Data</button> <button class="btn btn-s" onclick="fetchMarketNews()">Get Market Analysis</button></div>
<div id="market-news"></div>
</div></div>`,

proposal:`<div class="sec"><div class="sec-t">Proposal Builder</div>
<div class="card">
<div class="card-t"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>Customer Proposal Generator</div>
<div class="row">
<div class="fm-g"><label class="fm-l">Customer Name</label><input type="text" class="inp" id="prop-name" placeholder="Enter customer name"></div>
<div class="fm-g"><label class="fm-l">Industry</label>
<select class="inp" id="prop-industry">
<option value="manufacturing">Manufacturing</option>
<option value="commercial">Commercial Real Estate</option>
<option value="retail">Retail</option>
<option value="healthcare">Healthcare</option>
<option value="datacenters">Data Centers</option>
<option value="hospitality">Hospitality</option>
</select></div>
</div>
<div class="row">
<div class="fm-g"><label class="fm-l">Annual Energy Spend ($)</label><input type="number" class="inp" id="prop-spend" placeholder="500000"></div>
<div class="fm-g"><label class="fm-l">Annual kWh</label><input type="number" class="inp" id="prop-kwh" placeholder="2000000"></div>
</div>
<div class="fm-g"><label class="fm-l">Pain Points / Goals</label>
<textarea class="inp" id="prop-goals" placeholder="Describe the customer's main energy challenges or sustainability goals..."></textarea></div>
<div class="row">
<div class="fm-g"><label class="fm-l">Solutions to Include</label>
<div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px">
<label><input type="checkbox" id="sol-ems" checked> EMS</label>
<label><input type="checkbox" id="sol-solar"> Solar</label>
<label><input type="checkbox" id="sol-storage"> Battery Storage</label>
<label><input type="checkbox" id="sol-ev"> EV Charging</label>
<label><input type="checkbox" id="sol-microgrid"> Microgrid</label>
<label><input type="checkbox" id="sol-demand"> Demand Response</label>
</div></div>
</div>
<button class="btn" onclick="generateProposal()">Generate Proposal</button>
<div id="proposal-result"></div>
</div></div>`,

regs:`<div class="sec"><div class="sec-t">Regulation Tracker</div>
<div class="card">
<div class="card-t"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"/></svg>Energy Regulations & Compliance</div>
<div class="row">
<select class="inp" id="reg-state">
<option value="federal">Federal (FERC/EPA)</option>
<option value="california">California (CPUC/CEC)</option>
<option value="nevada">Nevada (PUCN)</option>
<option value="arizona">Arizona (ACC)</option>
<option value="texas">Texas (PUCT/ERCOT)</option>
</select>
<button class="btn" onclick="fetchRegulations()">Search Regulations</button>
</div>
<div id="reg-content"><div style="color:var(--t3);padding:20px;text-align:center">Select a jurisdiction and search for latest regulatory updates</div></div>
</div>
<div class="card">
<div class="card-t">Key Compliance Dates</div>
<table class="tbl">
<tr><th>Regulation</th><th>Jurisdiction</th><th>Deadline</th><th>Status</th></tr>
<tr><td>Clean Energy Standard</td><td>California</td><td>2026-12-31</td><td><span class="tag tag-y">Pending</span></td></tr>
<tr><td>Building Efficiency Standards</td><td>Nevada</td><td>2026-07-01</td><td><span class="tag tag-g">On Track</span></td></tr>
<tr><td>Grid Interconnection Rules</td><td>Federal</td><td>2026-03-15</td><td><span class="tag tag-b">In Review</span></td></tr>
</table>
</div></div>`,

load:`<div class="sec"><div class="sec-t">Load Analyzer</div>
<div class="card">
<div class="card-t"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>Load Profile Analysis</div>
<div class="row">
<div class="fm-g"><label class="fm-l">Building Type</label>
<select class="inp" id="load-type">
<option value="office">Office Building</option>
<option value="retail">Retail Store</option>
<option value="warehouse">Warehouse/Distribution</option>
<option value="manufacturing">Manufacturing Facility</option>
<option value="datacenter">Data Center</option>
<option value="hospital">Hospital/Healthcare</option>
</select></div>
<div class="fm-g"><label class="fm-l">Square Footage</label><input type="number" class="inp" id="load-sqft" placeholder="50000"></div>
</div>
<div class="row">
<div class="fm-g"><label class="fm-l">Operating Hours</label>
<select class="inp" id="load-hours">
<option value="8x5">8 hrs/day, 5 days/week</option>
<option value="12x5">12 hrs/day, 5 days/week</option>
<option value="24x5">24 hrs/day, 5 days/week</option>
<option value="24x7">24/7 Operation</option>
</select></div>
<div class="fm-g"><label class="fm-l">Climate Zone</label>
<select class="inp" id="load-climate">
<option value="hot-dry">Hot-Dry (Southwest)</option>
<option value="hot-humid">Hot-Humid (Southeast)</option>
<option value="mixed">Mixed (Mid-Atlantic)</option>
<option value="cold">Cold (Northeast/Midwest)</option>
<option value="marine">Marine (Pacific Coast)</option>
</select></div>
</div>
<button class="btn" onclick="analyzeLoad()">Analyze Load Profile</button>
<div id="load-result"></div>
</div></div>`,

outage:`<div class="sec"><div class="sec-t">Outage Map</div>
<div class="card">
<div class="card-t"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>Active Outages</div>
<div class="row">
<select class="inp" id="outage-region">
<option value="nevada">Nevada</option>
<option value="california">California</option>
<option value="arizona">Arizona</option>
<option value="texas">Texas</option>
</select>
<button class="btn" onclick="fetchOutages()">Check Outages</button>
</div>
<div id="outage-list"><div style="color:var(--t3);padding:20px;text-align:center">Select a region to view current power outages</div></div>
</div>
<div class="card">
<div class="card-t">Outage Statistics</div>
<div class="grid">
<div class="stat"><div class="stat-v" id="out-active">--</div><div class="stat-l">Active Outages</div></div>
<div class="stat"><div class="stat-v" id="out-affected">--</div><div class="stat-l">Customers Affected</div></div>
<div class="stat"><div class="stat-v" id="out-restored">--</div><div class="stat-l">Restored Today</div></div>
</div>
</div></div>`
};

// Navigation
document.querySelectorAll('.nb').forEach(btn=>{
btn.addEventListener('click',()=>{
document.querySelectorAll('.nb').forEach(b=>b.classList.remove('on'));
btn.classList.add('on');
mn.innerHTML=tools[btn.dataset.tool];
if(btn.dataset.tool==='market')refreshMarket();
});
});
mn.innerHTML=tools.brief;

// Perplexity API call
async function callPerplexity(query){
try{
const res=await fetch('https://api.perplexity.ai/chat/completions',{
method:'POST',
headers:{'Authorization':'Bearer '+PERPLEXITY_API_KEY,'Content-Type':'application/json'},
body:JSON.stringify({model:'llama-3.1-sonar-small-128k-online',messages:[{role:'user',content:query}],max_tokens:1000})
});
const data=await res.json();
return data.choices?.[0]?.message?.content||'No response received';
}catch(e){return 'Error: '+e.message;}
}

// Daily Brief
async function fetchBrief(){
const topic=document.getElementById('brief-topic').value;
const content=document.getElementById('brief-content');
content.innerHTML='<div style="text-align:center;padding:40px"><div class="ld"></div><div style="margin-top:12px;color:var(--t3)">Fetching latest intelligence...</div></div>';
const query=`As an energy market analyst, provide a brief executive summary about: ${topic}. Include key data points, recent developments, and implications for energy companies. Format with clear sections.`;
const result=await callPerplexity(query);
content.innerHTML=`<div class="brief-item"><div class="brief-cat tag-g">${document.getElementById('brief-topic').selectedOptions[0].text}</div><div class="brief-sum">${result.replace(/\n/g,'<br>')}</div></div>`;
}

// Rate Calculator
const rates={
nvenergy:{onpeak:0.12,offpeak:0.08,demand:12},
pge:{onpeak:0.35,offpeak:0.25,demand:20},
sce:{onpeak:0.32,offpeak:0.22,demand:18},
aps:{onpeak:0.14,offpeak:0.09,demand:10},
custom:{onpeak:0.15,offpeak:0.10,demand:15}
};

function calculateRate(){
const util=document.getElementById('calc-utility').value;
const kwh=parseFloat(document.getElementById('calc-kwh').value)||0;
const kw=parseFloat(document.getElementById('calc-kw').value)||0;
const onpeak=(parseFloat(document.getElementById('calc-onpeak').value)||0)/100;
const offpeak=(parseFloat(document.getElementById('calc-offpeak').value)||0)/100;
const r=rates[util];
const onpeakCost=kwh*onpeak*r.onpeak;
const offpeakCost=kwh*offpeak*r.offpeak;
const demandCost=kw*r.demand;
const total=onpeakCost+offpeakCost+demandCost;
const avgRate=total/kwh;
document.getElementById('calc-result').innerHTML=`
<div class="result-box">
<div class="card-t">Cost Breakdown</div>
<table class="tbl">
<tr><td>On-Peak Energy (${(kwh*onpeak).toFixed(0)} kWh @ $${r.onpeak}/kWh)</td><td>$${onpeakCost.toFixed(2)}</td></tr>
<tr><td>Off-Peak Energy (${(kwh*offpeak).toFixed(0)} kWh @ $${r.offpeak}/kWh)</td><td>$${offpeakCost.toFixed(2)}</td></tr>
<tr><td>Demand Charge (${kw} kW @ $${r.demand}/kW)</td><td>$${demandCost.toFixed(2)}</td></tr>
<tr style="font-weight:700;border-top:2px solid var(--bd)"><td>Total Monthly Cost</td><td>$${total.toFixed(2)}</td></tr>
<tr><td>Average Rate</td><td>$${avgRate.toFixed(4)}/kWh</td></tr>
</table>
</div>`;
}

// Market Monitor
function refreshMarket(){
const lmp=(35+Math.random()*30).toFixed(2);
const ng=(2.5+Math.random()*2).toFixed(2);
const demand=(25+Math.random()*15).toFixed(1);
const renewable=(30+Math.random()*25).toFixed(0);
document.getElementById('mkt-lmp').textContent='$'+lmp;
document.getElementById('mkt-ng').textContent='$'+ng;
document.getElementById('mkt-demand').textContent=demand;
document.getElementById('mkt-renewable').textContent=renewable+'%';
}

async function fetchMarketNews(){
const content=document.getElementById('market-news');
content.innerHTML='<div style="text-align:center;padding:20px"><div class="ld"></div></div>';
const result=await callPerplexity('Provide a brief analysis of current electricity market conditions, wholesale prices, and renewable energy trends in the US. Include specific numbers.');
content.innerHTML=`<div class="result-box"><div class="brief-sum">${result.replace(/\n/g,'<br>')}</div></div>`;
}

// Proposal Builder
async function generateProposal(){
const name=document.getElementById('prop-name').value||'Customer';
const industry=document.getElementById('prop-industry').value;
const spend=document.getElementById('prop-spend').value||'500000';
const kwh=document.getElementById('prop-kwh').value||'2000000';
const goals=document.getElementById('prop-goals').value||'reduce costs and improve sustainability';
const solutions=[];
if(document.getElementById('sol-ems').checked)solutions.push('Energy Management System');
if(document.getElementById('sol-solar').checked)solutions.push('Solar PV');
if(document.getElementById('sol-storage').checked)solutions.push('Battery Storage');
if(document.getElementById('sol-ev').checked)solutions.push('EV Charging Infrastructure');
if(document.getElementById('sol-microgrid').checked)solutions.push('Microgrid');
if(document.getElementById('sol-demand').checked)solutions.push('Demand Response');
const content=document.getElementById('proposal-result');
content.innerHTML='<div style="text-align:center;padding:40px"><div class="ld"></div><div style="margin-top:12px;color:var(--t3)">Generating proposal...</div></div>';
const query=`Create a brief energy proposal for ${name}, a ${industry} company. Current annual spend: $${spend}, annual usage: ${kwh} kWh. Goals: ${goals}. Recommended solutions: ${solutions.join(', ')}. Include estimated savings percentages and implementation timeline.`;
const result=await callPerplexity(query);
content.innerHTML=`<div class="result-box"><div class="card-t">Proposal for ${name}</div><div class="brief-sum">${result.replace(/\n/g,'<br>')}</div><div style="margin-top:16px"><button class="btn btn-s" onclick="copyProposal()">Copy to Clipboard</button></div></div>`;
}

function copyProposal(){
const text=document.querySelector('#proposal-result .brief-sum').innerText;
navigator.clipboard.writeText(text);
alert('Proposal copied to clipboard!');
}

// Regulation Tracker
async function fetchRegulations(){
const state=document.getElementById('reg-state').value;
const content=document.getElementById('reg-content');
content.innerHTML='<div style="text-align:center;padding:40px"><div class="ld"></div></div>';
const stateNames={federal:'Federal',california:'California',nevada:'Nevada',arizona:'Arizona',texas:'Texas'};
const result=await callPerplexity(`What are the latest energy regulations and policy updates in ${stateNames[state]}? Focus on rules affecting commercial/industrial energy users, renewable energy requirements, and utility rate changes.`);
content.innerHTML=`<div class="brief-item"><div class="brief-cat tag-b">${stateNames[state]} Regulations</div><div class="brief-sum">${result.replace(/\n/g,'<br>')}</div></div>`;
}

// Load Analyzer
function analyzeLoad(){
const type=document.getElementById('load-type').value;
const sqft=parseFloat(document.getElementById('load-sqft').value)||50000;
const hours=document.getElementById('load-hours').value;
const climate=document.getElementById('load-climate').value;
const intensities={office:15,retail:20,warehouse:8,manufacturing:25,datacenter:100,hospital:30};
const hourFactors={'8x5':0.24,'12x5':0.36,'24x5':0.6,'24x7':1};
const climateFactors={'hot-dry':1.3,'hot-humid':1.4,'mixed':1.0,'cold':1.2,'marine':0.9};
const baseLoad=sqft*intensities[type];
const annualKwh=baseLoad*hourFactors[hours]*8760*climateFactors[climate]/1000;
const peakDemand=annualKwh/(8760*hourFactors[hours])*1.5;
const avgRate=0.12;
const annualCost=annualKwh*avgRate;
document.getElementById('load-result').innerHTML=`
<div class="result-box">
<div class="card-t">Load Profile Analysis</div>
<div class="grid">
<div class="stat"><div class="stat-v">${(annualKwh/1000).toFixed(0)}k</div><div class="stat-l">Annual kWh</div></div>
<div class="stat"><div class="stat-v">${peakDemand.toFixed(0)}</div><div class="stat-l">Peak Demand (kW)</div></div>
<div class="stat"><div class="stat-v">$${(annualCost/1000).toFixed(0)}k</div><div class="stat-l">Est. Annual Cost</div></div>
</div>
<div style="margin-top:16px">
<div class="brief-sum"><strong>Recommendations:</strong><br>
• Consider TOU rate schedule to shift ${(hourFactors[hours]*20).toFixed(0)}% of load to off-peak<br>
• Potential solar offset: ${(annualKwh*0.4/1000).toFixed(0)}k kWh (40%)<br>
• Demand response potential: ${(peakDemand*0.15).toFixed(0)} kW reduction<br>
• Estimated savings with EMS: $${(annualCost*0.12/1000).toFixed(0)}k/year (12%)</div>
</div>
</div>`;
}

// Outage Map
function fetchOutages(){
const region=document.getElementById('outage-region').value;
const outages=[
{loc:'North Las Vegas',customers:2340,cause:'Equipment failure',eta:'2 hrs'},
{loc:'Henderson',customers:890,cause:'Planned maintenance',eta:'4 hrs'},
{loc:'Summerlin',customers:1560,cause:'Weather related',eta:'1 hr'}
];
const list=document.getElementById('outage-list');
list.innerHTML=outages.map(o=>`<div class="outage-item"><div><div class="outage-loc">${o.loc}</div><div class="outage-det">${o.cause} • ETA: ${o.eta}</div></div><div class="tag tag-r">${o.customers.toLocaleString()} affected</div></div>`).join('');
const total=outages.reduce((a,b)=>a+b.customers,0);
document.getElementById('out-active').textContent=outages.length;
document.getElementById('out-affected').textContent=total.toLocaleString();
document.getElementById('out-restored').textContent=Math.floor(Math.random()*500+100);
}
</script>
</body>
</html>
</div>
